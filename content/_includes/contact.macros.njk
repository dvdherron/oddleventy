{% import 'utility.macros.njk' as utility %}

{# @docs
label: Contact Macros
category: File
note: Forms related to OddBird communication.
#}


{# @docs
label: form
note: Generate a contact form
params:
  next:
    type: url
    default: '/contact/thanks/'
    note: The landing page after form-submit
  submit:
    type: string
    default: Send
    note: text for the submit button
  name:
    type: string
    default: contact
    note: |
      Name the form for special cases
      where a CSS hook is required
#}
{% macro form(
  next='/contact/thanks/',
  submit='Send',
  name='contact'
) %}
<form
  name="{{ name or 'contact' }}"
  data-form="{{ name or 'contact' }}"
  method="POST"
  action="{{ next }}"
  netlify-honeypot="subject"
  data-netlify="true">
  <div data-fieldgroup="contact-info">
    <label data-field="name">
      <span data-label>Name:</span>
      <input
        data-input="text"
        type="text"
        name="name"
        required />
    </label>
    <label data-field="email">
      <span data-label>Email:</span>
      <input
        data-input="text"
        type="email"
        name="email"
        required />
    </label>
  </div>
  <label data-field="message">
    <span data-label>Message:</span>
    <textarea
      data-input="textarea"
      name="message"
      required></textarea>
  </label>
  <label hidden>
    <span>Don't fill out this field:</span>
    <input name="subject" />
  </label>
  <div class="form-actions">
    <button
      data-btn="submit"
      type="submit">
      {{ submit }}
    </button>
  </div>
</form>
{% endmacro %}


{# @docs
label: subscribe
note: Generate an email-newsletter signup form
params:
  label:
    type: string
    default: Subscribe to our email newsletter
  action:
    type: string
    default: Subscribe
  interests:
    type: string
    default: oddnews
#}
{% macro subscribe(
  label='Subscribe to our email newsletter',
  action='Subscribe',
  interests='oddnews'
) -%}
  {%- set groups = [
    {
      'key': 'oddbooks',
      'label': 'OddBooks',
      'value': 1
    },
    {
      'key': 'book_tester',
      'label': 'OddBooks Tester',
      'value': 2
    },
    {
      'key': 'oddnews',
      'label': 'OddNews',
      'value': 4
    },
    {
      'key': 'vueconfus19',
      'label': 'Event: VueConf US 2019',
      'value': 8
    },
    {
      'key': 'beyondtellerand19',
      'label': 'Event: Beyond Tellerand 2019',
      'value': 16
    },
    {
      'key': 'smashingconf19',
      'label': 'Event: Smashing Conference 2019',
      'value': 32
    },
    {
      'key': 'generate19',
      'label': 'Event: Generate 2019',
      'value': 64
    }
  ] -%}

<!-- Begin Mailchimp Signup Form -->
<div id="mc_embed_signup">
<form {{ utility.show_attrs({
  'action': 'https://oddbird.us19.list-manage.com/subscribe/post?u=80219aa68d7bad77b9fd2eb93&id=7c27f7fb9a',
  'method': 'post',
  'id': 'mc-embedded-subscribe-form',
  'name': 'mc-embedded-subscribe-form',
  'class': 'validate',
  'target': '_blank',
  'novalidate': true,
  'data-form': 'email-subscribe'
}) }}>

<div id="mc_embed_signup_scroll" class="odd-input-group">
<label for="mce-EMAIL" data-field="contact-email">
<span data-label>{{ label }}</span>
<input {{ utility.show_attrs({
  'data-input': 'text',
  'type': 'email',
  'value': '',
  'name': 'EMAIL',
  'class': 'email',
  'id': 'mce-EMAIL',
  'placeholder': 'email address',
  'required': true
}) }}>
</label>

<ul hidden>
{%- for group in groups -%}
<li>
{%- set id = 'mce-group[2075]-2075-' + group.value -%}
<label for="{{ id }}">
<input {{ utility.show_attrs({
  'type': 'checkbox',
  'value': group.value,
  'name': 'group[2075][' + group.value + ']',
  'id': id,
  'checked': (group.key in interests)
}) }}>{{ group.label }}</label>
</li>
{%- endfor -%}
</ul>

<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
<div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_80219aa68d7bad77b9fd2eb93_7c27f7fb9a" tabindex="-1" value=""></div>

<div class="form-actions">
<button {{ utility.show_attrs({
  'type': 'submit',
  'name': 'subscribe',
  'id': 'mc-embedded-subscribe',
  'data-btn': 'small'
}) }}>{{ action }}</button>
</div>
</div>
</form>
</div>
<!--End mc_embed_signup-->
{% endmacro %}

{# @docs
label: social
note: Generate a list of social-media icon-links
params:
  data:
    type: object
    note: site-slug/user-id pairs
  name:
    type: string
    note: The name of the user
#}
{% macro social(
  data,
  name,
  details=false
) %}
  {%- set sites = {
    'email': {
      'user': '%s@oddbird.net',
      'url': 'mailto:%s@oddbird.net',
      'icon': 'mail',
      'hide_details': true
    },
    'twitter': {
      'user': '@%s',
      'url': 'https://twitter.com/%s/'
    },
    'github': {
      'url': 'https://github.com/%s/'
    },
    'codepen': {
      'title': 'CodePen',
      'url': 'https://codepen.io/%s/'
    },
    'dribbble': {
      'url': 'https://dribbble.com/%s/'
    },
    'stackoverflow': {
      'title': 'Stack Overflow',
      'url': 'https://stackoverflow.com/users/%s/',
      'text': name
    }
  } -%}

  {%- if data -%}
    <ul class="social-list">
    {%- for site, id in data -%}
      {%- set info = sites[site] -%}
      {%- if info -%}
        {%- set hide_details = info.hide_details or (not details) -%}
        {%- set text = info.user | replace("%s", id) if info.user else info.text or id -%}
        {%- set context %} <i>on</i> {{ info.title or site | capitalize }}{% endset -%}
        {%- set context = '<span class="sr-only">' + context + '</span>' if hide_details else context %}
        {%- set text = text + context if hide_details else text -%}
        <li>
          {{- utility.icon_link(
            icon='social/' + (info.icon or site),
            text=text | safe,
            url=info.url | replace("%s", id)
          ) -}}
          {{- context if not hide_details -}}
        </li>
      {%- endif -%}
    {%- endfor -%}
    </ul>
  {%- endif -%}
{% endmacro %}
