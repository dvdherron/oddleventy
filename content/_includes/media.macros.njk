{% import 'utility.macros.njk' as utility %}

{% macro img(
  src,
  alt='',
  attrs={}
) %}
  {% if src %}
    <img
      src="/assets/images/{{ src }}"
      alt="{{ alt }}"
      {{ utility.show_attrs(attrs) }}/>
  {% endif %}
{% endmacro %}

{% macro svg(
  path
) %}
  {% include path + '.svg' %}
{% endmacro %}

{% macro grid(
  image,
  name='',
  attrs={},
  reverse=false,
  content=none
) %}
  {%- set content = content if (content != none) else caller() -%}

  <div data-media="{{ name }}"
    {{ utility.attr_if('data-reverse', reverse) }}
    {{ utility.show_attrs(attrs) }}>

    <div class="media-image">
      {{ image | safe }}
    </div>

    <div class="media-content">
      {{ content | safe }}
    </div>
  </div>
{% endmacro %}

{% macro screen(
  device='iphone',
  fill=none,
  content=none
) %}
  {%- set content = content if (content != none) else caller() -%}
  {%- set style = ['--device-fill', fill] | join(':') if fill else none -%}
  <div data-screen="{{ device }}"
    {{ utility.attr_if('style', style) }}>
    {{ content | safe }}
    {% include 'devices/' + device + '.svg' %}
  </div>
{% endmacro %}

{% macro fig(
  data=none,
  caption=none
) -%}
{%- set content = _fig_content(data) if data else caller() | mdInline -%}
<figure data-pattern="figure">
<div data-figure="content">{#
#}{{ content | safe }}{#
#}</div>
{%- if caption -%}
<figcaption data-figure="caption">{#
#}{{ caption | mdInline | safe }}{#
#}</figcaption>
{%- endif -%}
</figure>
{%- endmacro %}

{#
  Ratios
  ------
#}
{% macro ratio(
  width=none,
  height=none,
  span=none
) -%}
{%- if width | typeCheck('number') and height | typeCheck('number') -%}
<div
  class="ratio"
  style="--ratio:{{ width / height }};{{ span }}">{#
#}{{ caller() }}{#
#}</div>
{%- else -%}
{{ caller() }}
{%- endif -%}
{%- endmacro %}

{#
  Placement
  ---------
#}
{% macro place(
  width,
  height=none
) -%}
{%- set width = ['--width:', width, ';'] | join if width else '' -%}
{%- set height = ['--height:', height, ';'] | join if height else '' -%}
{%- set style = [width, height] | join if (width or height) else none -%}
<div data-place {{ utility.attr_if('style', style) }}>{{ caller() }}</div>
{%- endmacro %}

{#
  Private
  -------
#}
{% macro _fig_content(
  data
) -%}
{%- for item in data -%}
{%- set span = ['--span:', item.span, ';'] | join if item.span else '' -%}
{%- if item.img -%}
{%- set src = item.img if ('://' in item.img) else ('/assets/images/' + item.img) -%}
{%- set width = ['--width:', item.width, ';'] | join if item.width else '' -%}
{%- set style = (width + span) if (width or span) else none -%}{#
#}<img src="{{ src }}" alt="{{ item.alt }}" {{ utility.attr_if('style', style) }}/>{#
#}{%- elif item.iframe -%}
{%- call ratio(item.width, item.height, span) -%}{#
#}<iframe src="{{ item.iframe }}" {{ utility.attr_if('width', item.width) }} {{ utility.attr_if('height', item.height) }} frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>{%- endcall -%}{#
#}{%- elif item.audio -%}{#
#}<audio src="{{ item.audio }}" style="--width: 100%;{{ span }}" controls>{{ item.audio | mdInline }}</audio>{#
#}{%- endif -%}
{%- endfor -%}
{%- endmacro %}


