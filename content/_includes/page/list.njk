{% import 'post.macros.njk' as post %}
{% import 'layout.macros.njk' as layout %}

{% set index = renderData.index or index %}
{% set index = {'slug': index} if index | typeCheck('string') else index %}

{% if index %}
  {% set event_pages = {
    'all': true,
    'only': false,
    'true': 'mixed'
  } %}
  {% set pages = event_pages[index.events] if index.events else 'mixed' %}
  {% set list = collections[index.slug] if index.slug else none %}
  {% set list = list | getEvents(pages) if index.events else list %}
  {{ post.by_year(list, collections) }}
{% elif bird and (bird != 'oddbird') %}
  {% set list = collections._post | byBird(bird) %}
  {{ post.by_year(list, collections) }}
{% elif events %}
  {{ layout.title('Events') }}
  <ol reversed>
    {% for event in events -%}
      {% set eventPage = {'date': page.date, 'event': event } %}
      <li>
        {% if eventPage | isFuture %}
          <strong>Upcoming!</strong>
        {% endif %}
        [{{ event.start | getDate('iso') }}]
        {{ utility.link_if(event.venue, event.url) }} --
        {{ event.adr }}
      </li>
    {% endfor %}
  </ol>
{% endif %}
