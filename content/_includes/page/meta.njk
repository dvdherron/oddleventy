{%- import 'utility.macros.njk' as utility -%}

{% set public_tags = collections | tagData(tags) %}
{% set public_tags = public_tags if public_tags | length else none %}
{% set elsewhere = {
  'venue': venue,
  'url': url
} if elsewhere else none %}

{% set sub = renderData.sub or sub %}

{% if sub or public_tags or elsewhere or author %}
  <div id="meta">
    {% if sub or dates %}
      <p class="subtitle">
        {{ sub | mdInline | safe }}
        {%- if sub and dates %}, {% endif %}
        {{ dates }}
      </p>
    {% endif %}

    {% if author %}
      <p class="byline">
        <i>by</i>
        {% set author_list = [author] if author | typeCheck('string') else author %}
        {% for name in author_list -%}
          {%- set by = collections.birds | authorPage(name) -%}
          {%- if by -%}
            {{ utility.link_if(
              content=by.data.title | mdInline | safe,
              url=by.url,
              class='h-card'
            ) }}
          {%- else -%}
            {{ name | capitalize }}
          {%- endif -%}
          {{ ', ' if not loop.last }}
        {%- endfor %}

        {% if elsewhere %}
          <i>at</i>
          {{ utility.link_if(
            content=elsewhere.venue | mdInline | safe,
            url=elsewhere.url,
            attrs={'rel': 'bookmark'}
          ) }}
        {% endif %}

        <i>on</i>
        {{ utility.datetime(
          start=start or date or page.date,
          end=end,
          format='long',
          is_pubdate=pubdate or page.date
        ) }}

        {% if adr %}
          <i>in</i>
          <span class="adr">
            {{ adr | typogr | safe }}
          </span>
        {% endif %}
      </p>
    {% endif %}

    {% if public_tags %}
      <div class="page-tags">
        {% include "icons/tags.svg" %}
        <ul class="taglist">
          {%- for item in public_tags -%}
            <li class="tag">
              {{ utility.link_if(
                content=item.tag,
                url=item.url,
                class='taglink'
              ) }}
            </li>
          {%- endfor -%}
        </ul>
      </div>
    {% endif %}
  </div>
{% endif %}
